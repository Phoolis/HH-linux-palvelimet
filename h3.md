# Apache web server

The Apache Software Foundation 2023: Apache HTTP Server Version 2.4 Documentation: [Name-based Virtual Host Support](https://httpd.apache.org/docs/2.4/vhosts/name-based.html)

Tiivistelmä:

- Verrattuna IP:hen perustuviin hosteihin: Name-based virtual host voi hostata montaa eri webbisivua samassa IP-osoitteessa
- Pyynnöt ohjataan ensin `IP:port `perusteella, ja jos tuolla kombinaatiolla löytyy useampi webbisivu, verrataan pyynnön `ServerName` ja `ServerAlias` palvelimelle asetettuihin nimiin
- Fallback: jos pyynnön `ServerName` ja/tai `ServerAlias` ei mätsää palvelimelle asetettuihin, valitaan ensimmäinen virtual host listasta
- `DocumentRoot` kertoo missä hakemistossa webbisivun koodi sijaitsee
- Basic syntax:
    ```
    <VirtualHost *:80>
        # This first-listed virtual host is also the default for *:80
        ServerName www.example.com
        ServerAlias example.com 
        DocumentRoot "/www/domain"
    </VirtualHost>
    
    <VirtualHost *:80>
        ServerName other.example.com
        DocumentRoot "/www/otherdomain"
    </VirtualHost>
    ```
- Useampi `ServerAlias` myös mahdollinen: `ServerAlias example.com *.example.com`
- Huom! Jokerimerkit: `* ?`  

[Tero Karvisen Apache Name Based Virtua Hosts ohje](https://terokarvinen.com/2018/04/10/name-based-virtual-hosts-on-apache-multiple-websites-to-single-ip-address/) 

Tiivistelmä yltä Apachen asennuksen ja konffaamisen peruskomennot:

- Asenna apache2 `sudo apt-get -y install apache2`
- Luo default html-index page polkuun `/var/www/html/index.html`
- Jokaisella webbisivulla (eli name-based virtual hostilla) on oma conffi-tiedostonsa `/etc/apache2/sites-available/pyora.example.com.conf`
- Esimerkki conffi-tiedosto:
    ```
    <VirtualHost *:80>
     ServerName pyora.example.com
     ServerAlias www.pyora.example.com
     DocumentRoot /home/xubuntu/publicsites/pyora.example.com
     <Directory /home/xubuntu/publicsites/pyora.example.com>
       Require all granted
     </Directory>
    </VirtualHost>
    ```
- Laita conffi päälle (julkaise sivu) `sudo a2ensite pyora.example.com`
- Restarttaa apache2 (tämä komento hyvä, sillä se ei aja alas muita jo hostattuja webbisivuja) `sudo systemctl restart apache2`
- Testaus curlilla:  `curl -H 'Host: pyora.example.com' localhost`
- Nimen reititystä voi testata ilman, että tarvitsee ostaa domainia jostain palvelusta, muokkaamalla `hosts` filua:
  ```
    $ sudoedit /etc/hosts
    127.0.0.1 localhost
    127.0.1.1 xubuntu
    127.0.0.1 pyora.example.com
  ```
