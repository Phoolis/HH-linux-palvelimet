# Maalisuora

Tehtävänanto: [Linux Palvelimet 2025 alkusyksy Tero Karvinen](https://terokarvinen.com/linux-palvelimet/).

## "Hei maailma!" kolmella kielellä

### Rust

[Rust](https://rust-lang.org/) on suorituskykyinen C-kieltä muistuttava ohjelmointikieli. Rust on käännettävä kieli, eli ohjelmat tulee kompiloida lähdetiedostosta (tekstiä) tietokoneella ajettavaksi binääriksi. Itse kielen saa parhaiten asennettua [rustup-työkalulla](https://rust-lang.github.io/rustup/installation/other.html#apt).

Asenna rustup:  `sudo apt install rustup`.

[Hello World koodi](https://doc.rust-lang.org/rust-by-example/hello.html):

```rust
// hello.rs
fn main() {
    // Statements here are executed when the compiled binary is called.

    // Print text to the console.
    println!("Hello World!");
}
```

Ensin piti ladata rust-paketit rustup:lla ja asettaa `rustc`-kääntäjälle defaultti `rustup default stable`. Sitten käännettiin ohjelmakoodi ajettavaan muotoon `rustc`-komennolla.

<img width="1164" height="603" alt="image" src="https://github.com/user-attachments/assets/2e3e3947-8d32-4978-8472-e1d4f2bab07f" />

<img width="418" height="102" alt="image" src="https://github.com/user-attachments/assets/361adca4-c76a-4977-8114-997c9bf6fe56" />

`hello`-ohjelma on nyt ajettavassa muodossa.

<img width="368" height="66" alt="image" src="https://github.com/user-attachments/assets/0a87c2e6-caad-4e77-a85d-0f42230e3aa4" />

### Go

[Go](https://go.dev/) (usein myös Golang) on myös käännettävä kieli, Googlen kehittämä. 

Asenna go:  `sudo apt install golang-go`.

[Hello world koodi](https://gobyexample.com/hello-world): 

```go
package main

import "fmt"

func main() {
	fmt.Printl("Hei maailma!")
}
```

Go tarvitsee fmt-paketin print komentoa varten: https://pkg.go.dev/fmt

Koodin voi ajaa `go run` -komennolla, tai sen voi kääntää suoraan ajettavaksi binääriksi:

<img width="549" height="125" alt="image" src="https://github.com/user-attachments/assets/85d34b64-1619-410a-829b-371d7a5b9ff9" />

### Lua

[Lua](https://www.lua.org/) on kevyt tulkattava skriptikieli, joten ohjelma on ajettava lua-tulkin läpi. Binäärin luominen vaatii enemmän työtä, eikä ominaisuus tule ainakaan lua-paketissa itsessään mukana.

Asenna lua: `sudo apt install lua5.4`.

<img width="522" height="78" alt="image" src="https://github.com/user-attachments/assets/7f40643a-5d36-4038-960f-053a04e568b1" />

"Hei maailma!" -ohjelman koodi yksinkertaisuudessaan:

```lua
print("Hei maailma!")
```

Ja sen ajaminen `lua hello.lua`:

<img width="397" height="78" alt="image" src="https://github.com/user-attachments/assets/407ee60f-b466-4416-a4cd-77d713815d07" />

## Uusi komento /bin hakemistoon

Ohjeet [Karvinen 2007: Shell Scripting](https://terokarvinen.com/2007/12/04/shell-scripting-4/).

Tein ohjelman `ll`, joka tulostaa kansion sisällön nätisti ja lisäksi hakemiston polun.

<img width="441" height="115" alt="image" src="https://github.com/user-attachments/assets/36747f0a-c205-4352-8883-e522b1c1a7d8" />

Kaikille `execute`-oikeudet:

<img width="667" height="305" alt="image" src="https://github.com/user-attachments/assets/07d02bfb-7ae1-4984-a009-adcfc2ac0749" />

Ja kopioin sen `/usr/local/bin `-kansioon:

<img width="619" height="287" alt="image" src="https://github.com/user-attachments/assets/5f2aa862-19ec-4820-bea5-d2dfe8dd0026" />

Luon väliaikaisen käyttäjän, jotta voin kokeilla toimiiko komento myös toisella käyttäjällä. Löysin [hyvät ohjeet väliaikaisen käyttäjän luomiseksi](https://www.geeksforgeeks.org/linux-unix/creating-a-user-with-an-expiry-date-in-linux/).

Luodaan käyttäjä, joka vanhentuu seuraavana päivänä: `sudo useradd -e 2025-10-04 mayfly`. Laitetaan sille salasana: `sudo passwd mayfly`, jotta voin sitten vaihtaa käyttäjää :`su mayfly`.

<img width="748" height="385" alt="image" src="https://github.com/user-attachments/assets/23d7def0-559e-4093-8db0-4e0e653bbb6e" />

Komento `ll` tulostaa hakemiston tiedostot ja polun myös toisella käyttäjällä.

## Vanha arvioitava laboratorioharjoitus

Etsin arvioitavia laboratorioharjoituksia Teron sivuilta hakusanalla `arvioitava`: <img width="699" height="118" alt="image" src="https://github.com/user-attachments/assets/e5f4c41f-e069-4206-b2fe-5a8a6251a836" />

Valitsin [Kevään 2024 Linux palvelimet lopputehtävän](https://terokarvinen.com/2024/arvioitava-laboratorioharjoitus-2024-linux-palvelimet/). Tehtävässä oli paljon jo tehtyjä alakohtia, en ryhdy niitä toistamaan tässä, mutta Django-kehitysympäristön pystyttäminen kiinnosti erityisesti, sillä olen tässä ohessa rakentamassa webbipalvelua kotlin-kielellä portfoliota varten. Mielenkiintoista nähdä, kuinka helposti minimisetupin saa pystyyn Djangolla. Katsotaan miten käy, sillä siitä on aikaa kun olen kirjoittanut mitään koodia Pythonilla viimeksi.

### Django kehitysympäristö pystyyn

Seuraan [Mozillan Django Web Framework - Setting up a Django development environment](https://developer.mozilla.org/en-US/docs/Learn_web_development/Extensions/Server-side/Django/development_environment) -ohjetta.

Python3 version 3.13.5 on jo asennettu koneelle (`python3 -V`). Pitää vielä asentaa Python Package Index eli `pip` pythonpakettien hallintaan `sudo apt install python3-pip`.

----

Lisään jo varoituksen tähän alkuun: Mozillan ohjeita noudattamalla EN saanut virtuaaliympäristöjä pystyyn Debian 13:lle. Jätän nämä sähläykset tähän kuitenkin jonkun (en kyllä ymmärrä kenen) iloksi.

### Sähläys alkaa

Seuraavaksi asennetaan virtuaalinen ympäristö Django-kehitystä varten: `sudo pip3 install virtualenvwrapper`.

<img width="1155" height="423" alt="image" src="https://github.com/user-attachments/assets/f697f761-0d39-431e-a800-6bf7db2da1ad" />

Jahas, virheilmoitus. Debian ei siis tykkää, että virtualenvwrapper ei ole Debianin hallinnoima? Katsotaan löytyykö tuota `pipx`-pakettia sitten: `apt search pipx`.

<img width="683" height="75" alt="image" src="https://github.com/user-attachments/assets/5cb22cac-b26f-402a-bc26-54f978c95327" />

Löytyi. Koikeillaas asentaa: `sudo apt install pipx`, ja asennuksen jälkeen `pipx --version` tulostaa `1.7.1`.

<img width="1143" height="245" alt="image" src="https://github.com/user-attachments/assets/9e0b1d32-0238-45a0-a276-deaac975b1b6" />

`Virtualenvwrapper`:in asennus onnistui `pipx`:llä. Laitetaan vielä tuon suosituksen mukaan se PATH-ympäristömuuttujaan komennolla `pipx ensurepath`. 

<img width="1109" height="177" alt="image" src="https://github.com/user-attachments/assets/09badd77-fcf6-4d19-8110-412c9b6bbfca" />

Lisäsin vielä bash completionin bash-conffiin: `echo 'eval "$(register-python-argcomplete pipx)' >> ~/.bashrc`.

<img width="1066" height="233" alt="image" src="https://github.com/user-attachments/assets/ed70b5c1-16ef-44dd-81d7-4e2996165720" />

Loggasin ulos ja sisään ja avasin taas terminaalin.

<img width="816" height="278" alt="image" src="https://github.com/user-attachments/assets/a5ff967e-e092-44b2-bd18-aa067c048a9f" />

Ups! Jäi viimeinen lainausmerkki uupumaan tuosta komennosta. Lisäsin puuttuvan `"`-merkin rivin loppuun ja loggasin jälleen ulos ja sisään. Ei enää varoitusta siitä.

Lisäsin seuraavat rivit vielä bashrc-conffiin:

```
export WORKON_HOME=$HOME/.virtualenvs
export VIRTUALENVWRAPPER_PYTHON=/usr/bin/python3
export VIRTUALENVWRAPPER_VIRTUALENV_ARGS=' -p /usr/bin/python3 '
export PROJECT_HOME=$HOME/Devel
source /usr/local/bin/virtualenvwrapper.sh
```

Ja ladataan conffi uudelleen shelliin: `source ~/.bashrc`.

<img width="755" height="78" alt="image" src="https://github.com/user-attachments/assets/33d65579-b33b-4073-bc5f-dfdb431698fe" />

No piru. Ei ollut tuolla. Etsitään `which virtualenvwrapper.sh`...

Tässä välissä paljon muuta sähläystä, mikä jäi raportoimatta. Summa summarum: hermot meni tämän kanssa. En vaan millään saanut `virtualenvwrapper.sh`-tiedostoa löytymään tai toimimaan oikein silloinkun se oli asennettu `pipx`-paketinhallinnan kautta.

----

### Sähläys loppuu

Päätin poistaa koko höskän ja asentaa debianin apt-repositoriosta löytyvän `python3-virtualenv` -paketin.

<img width="1180" height="287" alt="image" src="https://github.com/user-attachments/assets/7eff7086-0492-4199-b946-d93d94fb93fa" />

Ja sitten `sudo apt install virtualenvwrapper` ja muokkasin oikeat polut bashrc-filuun:

```
export WORKON_HOME=$HOME/.virtualenvs
export VIRTUALENVWRAPPER_PYTHON=/usr/bin/python3
source /usr/share/virtualenvwrapper/virtualenvwrapper.sh
```

Päivitys `source ~/.bashrc`.

<img width="899" height="252" alt="image" src="https://github.com/user-attachments/assets/a5be537b-d5c2-4617-8ce8-a25521aa8246" />

Nyt tuli oikean näköistä roinaa terminaaliin. Hyvä! Luon virtuaaliympäristön `mkvirtualenv my_django_environment`.

<img width="1278" height="232" alt="image" src="https://github.com/user-attachments/assets/91eb6ddf-748e-486d-bfea-95f91abb9a9c" />

Näyttäisi toimivan! Eihän tässä mennyt kuin vajaa kaksi tuntia säätäessä. Tästä voi sitten jatkaa Djangon asentamisella ja weppipalvelun pystyttämisellä.

----

No huh. Eikun eteenpäin tehtävänannon kanssa. Tehtävänantohan meni näin:


    Asenna omalle käyttäjällesi Django-kehitysympäristö
    Tee tietokantaan lista tekoälyistämme, jossa on nämä ominaisuudet
        Kirjautuminen salasanalla
        Tietokannan muokkaus wepissä Djangon omalla ylläpitoliittymällä (Django admin)
        Käyttäjä Erkille, jossa ei ole ylläpito-oikeuksia
        Taulu Assistants, jossa jokaisella tietueella on nimi (name)
        Jos haluat, voit lisäksi bonuksena laittaa mukaan kentän koko (size)

Kaikki seuraavat komennot suoritetaan `my_django_environment` -virtuaaliympäristön sisällä.

Asennetaan Django-kehitysympäristö pythonin virtuaaliympäristöön `python3 -m pip install django~=4.2`, ja alustetaan sinne projekti `django-admin startproject ai_kakone`. Mennään projektikansioon `cd ai_kakone`. Käynnistetään palvelin `python3 manage.py runserver`. 

<img width="1340" height="251" alt="image" src="https://github.com/user-attachments/assets/a12f4dbf-23f0-47aa-8920-badf15f65d32" />

Ei välitetä varoituksista vaan navigoidaan selaimella `http://127.0.0.1:8000/`:

<img width="809" height="863" alt="image" src="https://github.com/user-attachments/assets/763abb50-ce06-45fc-b48f-0b9b03a725c2" />

Toimii! Seuraavaksi aletaan pala palalta lisäillä nuota tehtävänannon toiminnallisuuksia. `python manage.py migrate` luo kaikki Djangon perusasetukset, ja `python manage.py createsuperuser` luo pääkäyttäjän:

<img width="959" height="691" alt="image" src="https://github.com/user-attachments/assets/02fb15e4-cbb5-4fb1-96bb-1556ce7e13e9" />

Nyt voidaan käynnistää palvelu uudellee, ja navigoida admin-paneeliin `http://127.0.0.1:8000/admin`

<img width="661" height="433" alt="image" src="https://github.com/user-attachments/assets/82b3fdb3-141e-4312-9ab1-8addae5b6826" />

Ja logata sisään juuri luoduilla tunnuksilla:

<img width="693" height="375" alt="image" src="https://github.com/user-attachments/assets/c84c1826-837e-41be-8c5b-2f9342b730dc" />

Lisäsin käyttäjän `Erkki` webbiliittymän kautta ja varmistin, että hänellä ei ole `staff` eikä `superuser` oikeuksia.

<img width="948" height="697" alt="image" src="https://github.com/user-attachments/assets/2061e403-f200-4634-a8d6-625917dd2cec" />

Hyvä Erkki! Seuraavaksi lisätään `Assistants`-taulu. Ymmärrykseni Django:sta on vielä vasta alkeellista, mutta ohjeiden mukaan pitää luoda Django appi, joka siis grouppaa yhteen samankaltaisia toiminnallisuuksia, kuten tietokannan taulukoita ja niiden näkymiä. Luodaan `Assistants`-appi komennolla `python manage.py startapp assistants`. Lisätään assistants `ai_kakone/settings.py` tiedostoon:

<img width="440" height="230" alt="image" src="https://github.com/user-attachments/assets/8c840d41-75eb-46de-b8c7-40d585394a6c" />

Lisätään `Assistants`-taulun rakenne `assistants/models.py` tiedostoon:

```python
from django.db import models

class Assistant(models.Model):
    name = models.CharField(max_length=50)
    size = models.CharField(max_length=50, blank=True, null=True)

    def __str__(self):
        return self.name
```

Ja viedään uusi taulun model tietokantaan `python manage.py makemigrations` ja  `python manage.py migrate` komennoilla. Käsittääkseni tässä käy niin, että `makemigrations` valmistelee tietokantaan vietävät muutokset python-koodin mukaan, mutta ei vielä tee mitään pysyviä muutoksia, ja vasta `migrate` tekee todelliset muutokset tietokantaan.

<img width="906" height="206" alt="image" src="https://github.com/user-attachments/assets/fa11312e-8933-4904-b71d-011bb259e78c" />

Nyt taulu on viety tietokantaan, mutta se pitää vielä tuoda admin-paneelin näkyville muokkaamalla `assistants/admin.py` tiedostoa:

```python
from django.contrib import admin
from .models import Assistant

# Register your models here.

admin.site.register(Assistant)
```

<img width="1051" height="371" alt="image" src="https://github.com/user-attachments/assets/ff1484c8-f784-4513-b77e-191bb47dd6df" />

Siellä se näkyy. Sinne voi nyt webbisivun kautta lisätä AI Kakone firman kehittämiä tekoälyjä tietokantaan:

<img width="587" height="256" alt="image" src="https://github.com/user-attachments/assets/e6cc3d5b-b333-49ef-99da-de8c4080fca0" />

Siinä se lyhykäisyydessään. Tämähän olisi ollut ihan mukavaakin, jos itse pythonin ja virtuaaliympäristöjen kanssa tapellessa ei olisi mennyt niin paljon aikaa, ja olisi voinut keskittyä itse Djangon opettelemiseen. Toisaalta tämä on sitä tietotekniikkaa parhaimmillaan - aina ei voi tietää etukäteen että mitä ongelmia sitä itseasiassa joutuu selvittämään jonkun projektin kanssa. Mutta hauska uusi tuttavuus, pitää joskus paremmalla ajalla jatkaa Djangon kanssa nyt kun se kerran on pystyssä.


# Lähteet

1. Karvinen, T. Linux Palvelimet 2025 alkusyksy. terokarvinen.com. Luettavissa: https://terokarvinen.com/linux-palvelimet/. Luettu: 4.10.2025.
2. The rustup book. Other installation methods. rust-lang.github.io. Luettavissa: https://rust-lang.github.io/rustup/installation/other.html#apt. Luettu: 4.10.2025.
3. Rust by example. Hello World. doc.rust-lang.org. Luettavissa: https://doc.rust-lang.org. Luettu: 4.10.2025.
4. McGranaghan, M ja Bendersky, E. Go by Example: Hello World. gobyexample.com. Luettavissa: https://gobyexample.com/hello-world. Luettu: 4.10.2025.
5. Karvinen, T. Shell Scripting. terokarvinen.com. Luettavissa: https://terokarvinen.com/2007/12/04/shell-scripting-4/. Luettu: 4.10.2025.
6. behlanmol. Creating a User With an Expiry Date in Linux. geeksforgeeks.org. Luettavissa: https://www.geeksforgeeks.org/linux-unix/creating-a-user-with-an-expiry-date-in-linux/. Luettu: 4.10.2025.
7. Karvinen, T. Final Lab for Linux Palvelimet 2024 Spring. terokarvinen.com. Luettavissa: https://terokarvinen.com/2024/arvioitava-laboratorioharjoitus-2024-linux-palvelimet/. Luettu: 4.10.2025.
8. Mozilla Foundation. Setting up a Django development environment. developer.mozilla.org. Luettavissa: https://developer.mozilla.org/en-US/docs/Learn_web_development/Extensions/Server-side/Django/development_environment. Luettu: 4.10.2025.

----
Licensed under Creative Commons [CC BY 4.0](https://creativecommons.org/licenses/by/4.0/)

CC BY: credit must be given to the creator, Paul Carlson.
